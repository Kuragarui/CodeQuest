[gd_scene load_steps=16 format=3 uid="uid://dhbm5dkq7d8oa"]

[ext_resource type="Texture2D" uid="uid://clnlokqmnqe5j" path="res://assets/Character_animation/sundalong bert/frame 1.png" id="1_2tbpg"]
[ext_resource type="Texture2D" uid="uid://c8a64wtm322ga" path="res://assets/Character_animation/sundalong bert/frame 2.png" id="2_5oqko"]
[ext_resource type="Texture2D" uid="uid://dsvm7dc5cnpv7" path="res://assets/Character_animation/sundalong bert/frame 3.png" id="3_8dyya"]
[ext_resource type="Texture2D" uid="uid://du6dmbyr2jofm" path="res://assets/Character_animation/sundalong bert/frame 4.png" id="4_dv2cq"]
[ext_resource type="Texture2D" uid="uid://bc870syruufle" path="res://assets/Character_animation/sundalong bert/frame 5.png" id="5_8nrsx"]
[ext_resource type="Texture2D" uid="uid://2ek4ligwlcjh" path="res://assets/Character_animation/sundalong bert/frame 6.png" id="6_j0dim"]

[sub_resource type="GDScript" id="GDScript_265yp"]
script/source = "extends CharacterBody2D

@onready var animated_sprite = $AnimatedSprite2D

signal fight_started
signal fight_ended

var speed := 100
var last_direction := 1  # 1 = right, -1 = left

# --- Interaction states ---
var talked_to_guide := false
var talked_to_master := false

# --- Battle state ---
var fight_active := false

func _ready():
	add_to_group(\"Player\")
	# Connect to NPCs if they exist
	var guide = get_node_or_null(\"../Guide\")
	var master = get_node_or_null(\"../Master\")
	
	if guide:
		guide.connect(\"talked_to\", Callable(self, \"_on_talked_to_guide\"))
	if master:
		master.connect(\"talked_to\", Callable(self, \"_on_talked_to_master\"))

func _physics_process(delta):
	var direction := Vector2.ZERO
	
	# --- Movement Input ---
	direction.x = int(Input.is_action_pressed(\"ui_right\")) - int(Input.is_action_pressed(\"ui_left\"))
	direction.y = int(Input.is_action_pressed(\"ui_down\")) - int(Input.is_action_pressed(\"ui_up\"))
	
	if direction != Vector2.ZERO:
		direction = direction.normalized()
		velocity = direction * speed
		move_and_slide()
		
		# Flip and animate
		last_direction = 1 if direction.x > 0 else -1 if direction.x < 0 else last_direction
		animated_sprite.flip_h = last_direction == -1
		
		if not animated_sprite.is_playing():
			animated_sprite.play(\"walk\")
	else:
		velocity = Vector2.ZERO
		move_and_slide()
		animated_sprite.stop()
		animated_sprite.flip_h = last_direction == -1

# --- NPC interaction handlers ---
func _on_talked_to_guide():
	talked_to_guide = true
	print(\"âœ… Talked to Guide\")

func _on_talked_to_master():
	talked_to_master = true
	print(\"âœ… Talked to Master\")

# --- Fight control ---
func start_fight():
	if fight_active:
		return
	fight_active = true
	print(\"âš”ï¸ Fight started!\")
	emit_signal(\"fight_started\")

func end_fight():
	if not fight_active:
		return
	fight_active = false
	print(\"ðŸ Fight ended!\")
	emit_signal(\"fight_ended\")

# --- Enemy defeat handler ---
func defeat_enemy1():
	var enemy1 = get_node_or_null(\"../Enemy1\")
	if enemy1:
		enemy1.mark_defeated()
		print(\"âœ… Enemy1 defeated by player!\")
	else:
		print(\"âš ï¸ Enemy1 not found!\")
"

[sub_resource type="AtlasTexture" id="AtlasTexture_n1hhh"]
atlas = ExtResource("1_2tbpg")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_yqqum"]
atlas = ExtResource("2_5oqko")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_gn0on"]
atlas = ExtResource("3_8dyya")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_siec0"]
atlas = ExtResource("4_dv2cq")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_xifru"]
atlas = ExtResource("5_8nrsx")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kcwji"]
atlas = ExtResource("6_j0dim")
region = Rect2(0, 0, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_gwbg4"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_n1hhh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yqqum")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gn0on")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_siec0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xifru")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kcwji")
}],
"loop": true,
"name": &"walk",
"speed": 10.0
}]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_78bc2"]
radius = 3.33333
height = 17.1429

[node name="Player" type="CharacterBody2D"]
z_index = 1
z_as_relative = false
scale = Vector2(0.7, 0.7)
script = SubResource("GDScript_265yp")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
scale = Vector2(0.7, 0.7)
sprite_frames = SubResource("SpriteFrames_gwbg4")
animation = &"walk"
frame = 5
frame_progress = 0.70488

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -7.14286)
shape = SubResource("CapsuleShape2D_78bc2")
